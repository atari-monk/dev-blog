```bash
source .venv/bin/activate   # Linux / macOS
```
```bash
uvicorn app.main:app --reload
```
Zobaczmy, co jest nie tak z tworzeniem permissions. Problem najczÄ™Å›ciej wynika z dwÃ³ch rzeczy:

1. **Token JWT nie zostaÅ‚ prawidÅ‚owo skopiowany** do Authorize
2. **Brak roli `guard`** przed przypisaniem do niej permission

ZrÃ³bmy krok po kroku:

## KROK 1ï¸âƒ£ SprawdÅº czy token jest w Authorize

### OtwÃ³rz swagger (`/docs`) i kliknij ğŸ”’ **Authorize** (http://127.0.0.1:8000/docs#)

**Upewnij siÄ™, Å¼e:** 
- Token zaczyna siÄ™ od `Bearer` (z duÅ¼ej litery)
- Po `Bearer` jest spacja
- Token jest kompletny (bez ... na koÅ„cu)

PrzykÅ‚ad poprawnego formatu:
```
Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhbGljZSIsImV4cCI6MTcxMjM0NTYwMH0.abc123def456
```

UWAGA! PowyÅ¼ej jest konwencja ale mÃ³j setup nie wymaga 'Bearer ', tylko token !

Kliknij:
- **Authorize**
- **Close**

## KROK 2ï¸âƒ£ SprawdÅº czy rola istnieje

**WAÅ»NE:** Najpierw musisz przypisaÄ‡ rolÄ™ uÅ¼ytkownikowi, dopiero potem moÅ¼na dodaÄ‡ do niej permission.

### Najpierw wykonaj:

**Kliknij:** `POST /roles/assign`

```json
{
  "username": "alice",
  "role": "guard"
}
```

**Execute** - powinno zwrÃ³ciÄ‡ 200 OK

## KROK 3ï¸âƒ£ Teraz sprÃ³buj dodaÄ‡ permission

**Kliknij:** `POST /permissions/create`

WypeÅ‚nij:
- `resource`: `door1`
- `action`: `access`
- `role_name`: `guard`

**Execute**

---

## JeÅ›li nadal bÅ‚Ä…d, zrÃ³b peÅ‚nÄ… sekwencjÄ™:

### 1. Zarejestruj uÅ¼ytkownika
```bash
curl -X POST "http://localhost:8000/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"username": "alice", "password": "secret"}'
```

### 2. Zaloguj siÄ™ i skopiuj token
```bash
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "alice", "password": "secret"}'
```

OdpowiedÅº bÄ™dzie:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

### 3. Przypisz rolÄ™
```bash
curl -X POST "http://localhost:8000/roles/assign" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{"username": "alice", "role": "guard"}'
```

### 4. Teraz dodaj permission
```bash
curl -X POST "http://localhost:8000/permissions/create" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "resource": "door1",
    "action": "access",
    "role_name": "guard"
  }'
```

---

## CzÄ™ste problemy i rozwiÄ…zania:

### âŒ Problem 1: "Invalid or expired token"
RozwiÄ…zanie: Skopiuj token dokÅ‚adnie bez cudzysÅ‚owÃ³w

### âŒ Problem 2: "User not found" w roles/assign
RozwiÄ…zanie: Upewnij siÄ™ Å¼e `username` jest poprawny (alice)

### âŒ Problem 3: Role nie istnieje w permissions/create
RozwiÄ…zanie: **Najpierw** wykonaj `/roles/assign` dla roli `guard`

### âŒ Problem 4: W Swagger nie dziaÅ‚a Å¼adna operacja z Auth
RozwiÄ…zanie:
1. Kliknij ğŸ”’ **Authorize**
2. Kliknij **Logout**
3. Wpisz token ponownie od poczÄ…tku
4. Kliknij **Authorize** â†’ **Close**

---

## Aby sprawdziÄ‡ czy dziaÅ‚a, wykonaj test:

```bash
# SprawdÅº permission
curl -X POST "http://localhost:8000/permissions/check" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "resource": "door1",
    "action": "access"
  }'
```

Powinno zwrÃ³ciÄ‡:
```json
{
  "allowed": true
}
```

---

**JeÅ›li nadal nie dziaÅ‚a**, podaj dokÅ‚adny komunikat bÅ‚Ä™du, a znajdziemy rozwiÄ…zanie.